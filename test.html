<script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/duration.js"></script>
<script>
dayjs.extend(dayjs_plugin_duration);

// parseSmsDate – SMS სტრიქონიდან Day.js ობიექტზე გადაყვანა
function parseSmsDate(smsDate) {
  const regex = /(\d{1,2})-(\d{1,2})-(\d{4}):(\d{1,2}):(\d{1,2}):(\d{1,2})/;
  const match = smsDate.match(regex);
  if (!match) return dayjs.invalid();

  const [_, d, m, y, h, mi, s] = match;

  const pad = n => String(n).padStart(2,'0');

  return dayjs(`${y}-${pad(m)}-${pad(d)}T${pad(h)}:${pad(mi)}:${pad(s)}`);
}

// computeDiffObject – ითვლის სხვაობას
function computeDiffObject(fromSms, toSms) {
  const start = parseSmsDate(fromSms);
  const end = parseSmsDate(toSms);

  const years = end.diff(start, 'year');
  const afterYears = start.add(years, 'year');
  const months = end.diff(afterYears, 'month');
  const afterMonths = afterYears.add(months, 'month');
  const days = end.diff(afterMonths, 'day');
  const afterDays = afterMonths.add(days, 'day');
  const hours = end.diff(afterDays, 'hour');
  const afterHours = afterDays.add(hours, 'hour');
  const minutes = end.diff(afterHours, 'minute');
  const afterMinutes = afterHours.add(minutes, 'minute');
  const seconds = end.diff(afterMinutes, 'second');

  return { years, months, days, hours, minutes, seconds };
}

// computeDiffAndSend – JSON-ს Console/WebView-ში აგზავნის
function computeDiffAndSend(fromSms, toSms) {
  const res = computeDiffObject(fromSms, toSms);
  const payload = JSON.stringify(res);

  if (window.ReactNativeWebView && typeof window.ReactNativeWebView.postMessage === 'function') {
    window.ReactNativeWebView.postMessage(payload);
  } else if (window.parent && typeof window.parent.postMessage === 'function') {
    window.parent.postMessage(payload, '*');
  } else {
    console.log(payload);
  }

  return payload;
}

// ტესტი – ნებისმიერი ფორმატის SMS
console.log(computeDiffAndSend("5-10-2025:12:54:28", "29-10-2025:11:30:0"));
</script>
